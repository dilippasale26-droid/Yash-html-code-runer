<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yash Code Studio Pro</title>
    <meta name="theme-color" content="#1e1e1e">
    
    <!-- PWA Link -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="html_coder.png">

    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <!-- Ace Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.7/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.7/ext-language_tools.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.7/ext-beautify.min.js"></script>

    <style>
        :root {
            --bg-main: #1e1e1e;
            --bg-sec: #252526;
            --accent: #007acc;
            --text-main: #d4d4d4;
            --border: #333;
            --toast-bg: #323232;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-main);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- HEADER --- */
        header {
            height: 55px;
            background: var(--bg-sec);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid var(--border);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .brand {
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .brand img { height: 30px; border-radius: 5px; }

        .controls { display: flex; gap: 8px; }

        .btn {
            background: #3c3c3c;
            border: none;
            color: #eee;
            padding: 8px 14px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: 0.2s;
        }
        .btn:hover { background: #505050; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: #0062a3; }
        
        /* Install Button (Hidden by default) */
        #install-btn {
            background: #28a745; 
            display: none; 
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

        /* --- LAYOUT --- */
        .container { display: flex; flex: 1; height: calc(100vh - 55px); }

        .sidebar {
            width: 50px;
            background: var(--bg-sec);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 10px;
        }
        .icon-btn {
            width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            color: #858585; cursor: pointer; font-size: 1.2rem;
            border-radius: 5px; margin-bottom: 5px; transition: 0.2s;
        }
        .icon-btn:hover, .icon-btn.active { color: #fff; background: #3c3c3c; }
        .icon-btn.active { border-left: 3px solid var(--accent); }

        .workspace { flex: 1; display: flex; position: relative; }

        #editor-box { width: 50%; height: 100%; position: relative; }
        #editor { width: 100%; height: 100%; font-family: 'JetBrains Mono', monospace; font-size: 14px; }
        
        #preview-box { width: 50%; height: 100%; background: white; display: flex; flex-direction: column; }
        iframe { flex: 1; border: none; width: 100%; height: 100%; }

        .resizer {
            width: 6px; background: var(--bg-main); cursor: col-resize;
            border-left: 1px solid #333; display: flex; align-items: center; justify-content: center;
        }
        .resizer::after { content: 'â‹®'; color: #555; }

        /* --- TOAST NOTIFICATION --- */
        .toast {
            position: fixed; bottom: 20px; right: 20px;
            background: var(--toast-bg); color: white;
            padding: 12px 20px; border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex; align-items: center; gap: 10px;
            transform: translateY(100px); opacity: 0;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 1000; border-left: 4px solid var(--accent);
        }
        .toast.show { transform: translateY(0); opacity: 1; }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .workspace { flex-direction: column; }
            #editor-box, #preview-box { width: 100% !important; height: 50%; }
            .resizer { width: 100%; height: 8px; cursor: row-resize; transform: rotate(90deg); }
            .sidebar { display: none; }
            .brand span { display: none; }
            .btn span { display: none; } /* Show icons only on mobile */
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <img src="html_coder.png" alt="Logo" onerror="this.style.display='none'">
            <span>Yash Code Studio</span>
        </div>
        <div class="controls">
            <button class="btn" id="install-btn" onclick="installPWA()"><i class="fa-solid fa-download"></i> Install App</button>
            <button class="btn" onclick="formatCode()" title="Format"><i class="fa-solid fa-wand-magic-sparkles"></i></button>
            <button class="btn" onclick="toggleLive()" id="live-btn" title="Live Preview"><i class="fa-solid fa-bolt"></i></button>
            <button class="btn btn-primary" onclick="runCode()"><i class="fa-solid fa-play"></i> <span>Run</span></button>
        </div>
    </header>

    <div class="container">
        <div class="sidebar">
            <div class="icon-btn active"><i class="fa-solid fa-code"></i></div>
            <div class="icon-btn" onclick="insertTemplate('three')"><i class="fa-solid fa-cube"></i></div>
            <div class="icon-btn" onclick="downloadCode()"><i class="fa-solid fa-file-export"></i></div>
            <div class="icon-btn" style="margin-top:auto" onclick="clearCode()"><i class="fa-solid fa-trash"></i></div>
        </div>

        <div class="workspace">
            <div id="editor-box"><div id="editor"></div></div>
            <div class="resizer" id="resizer"></div>
            <div id="preview-box">
                <iframe id="preview"></iframe>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"><i class="fa-solid fa-info-circle"></i> <span id="toast-msg">Message</span></div>

    <script>
        // --- 1. SETUP EDITOR ---
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/one_dark");
        editor.session.setMode("ace/mode/html");
        editor.setOptions({
            fontSize: "14px",
            enableBasicAutocompletion: true,
            enableLiveAutocompletion: true,
            showPrintMargin: false,
            tabSize: 2
        });

        // Default Code
        const defaultCode = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Project</title>
    <style>
        body { 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; background: #0d1117; color: white; 
            font-family: sans-serif; flex-direction: column;
        }
        h1 { background: linear-gradient(to right, #00c6ff, #0072ff); -webkit-background-clip: text; color: transparent; }
        button { padding: 10px 20px; background: #238636; border: none; color: white; border-radius: 5px; cursor: pointer; font-size: 1rem; }
        button:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <h1>Hello Developer!</h1>
    <p>Welcome to Yash Code Studio Pro</p>
    <button onclick="alert('Code Running Successfully!')">Test Button</button>
</body>
</html>`;

        // Load saved code
        if(localStorage.getItem('yash_code')) {
            editor.setValue(localStorage.getItem('yash_code'), -1);
        } else {
            editor.setValue(defaultCode, -1);
        }

        // --- 2. RUN LOGIC ---
        let isLive = false;
        
        function runCode() {
            const code = editor.getValue();
            localStorage.setItem('yash_code', code);
            const iframe = document.getElementById('preview');
            iframe.srcdoc = code;
            showToast("Code Executed!");
        }

        function toggleLive() {
            isLive = !isLive;
            const btn = document.getElementById('live-btn');
            if(isLive) {
                btn.style.color = "#ffeb3b";
                showToast("Live Preview ON");
                editor.session.on('change', runCode);
            } else {
                btn.style.color = "#eee";
                showToast("Live Preview OFF");
                editor.session.off('change', runCode);
            }
        }

        // --- 3. FEATURES ---
        function formatCode() {
            const beautify = ace.require("ace/ext/beautify");
            beautify.beautify(editor.session);
            showToast("Code Formatted");
        }

        function downloadCode() {
            const blob = new Blob([editor.getValue()], {type: "text/html"});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = "index.html";
            link.click();
        }

        function clearCode() {
            if(confirm("Delete all code?")) {
                editor.setValue("", -1);
                runCode();
            }
        }

        function insertTemplate(type) {
            if(type === 'three') {
                const threeTemplate = `<!-- Three.js Setup -->\n<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"><\/script>\n<script>\n  const scene = new THREE.Scene();\n  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);\n  const renderer = new THREE.WebGLRenderer();\n  renderer.setSize(window.innerWidth, window.innerHeight);\n  document.body.appendChild(renderer.domElement);\n  const geometry = new THREE.BoxGeometry();\n  const material = new THREE.MeshBasicMaterial({color: 0x00ff00, wireframe: true});\n  const cube = new THREE.Mesh(geometry, material);\n  scene.add(cube);\n  camera.position.z = 5;\n  function animate() { requestAnimationFrame(animate); cube.rotation.x += 0.01; cube.rotation.y += 0.01; renderer.render(scene, camera); }\n  animate();\n<\/script>`;
                editor.insert(threeTemplate);
                showToast("Three.js Template Added");
            }
        }

        // --- 4. TOAST UI ---
        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        // Initial Run
        setTimeout(runCode, 500);

        // --- 5. RESIZER LOGIC ---
        const resizer = document.getElementById('resizer');
        const leftSide = document.getElementById('editor-box');
        let x = 0, w = 0;

        const mouseDownHandler = function(e) {
            x = e.clientX;
            w = leftSide.getBoundingClientRect().width;
            document.addEventListener('mousemove', mouseMoveHandler);
            document.addEventListener('mouseup', mouseUpHandler);
            document.getElementById('preview').style.pointerEvents = 'none';
        };

        const mouseMoveHandler = function(e) {
            const dx = e.clientX - x;
            const parentW = resizer.parentNode.getBoundingClientRect().width;
            const newW = ((w + dx) * 100) / parentW;
            if(newW > 10 && newW < 90) leftSide.style.width = `${newW}%`;
        };

        const mouseUpHandler = function() {
            document.removeEventListener('mousemove', mouseMoveHandler);
            document.removeEventListener('mouseup', mouseUpHandler);
            document.getElementById('preview').style.pointerEvents = 'auto';
            editor.resize();
        };

        resizer.addEventListener('mousedown', mouseDownHandler);

        // --- 6. PWA INSTALLATION LOGIC ---
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');

        // Check if service worker is supported
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service_worker.js')
                .then(() => console.log('Service Worker Registered'))
                .catch(err => console.log('SW Fail:', err));
        }

        // Listen for "Add to Home Screen" event
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex'; // Show button
        });

        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            }
        }
    </script>
</body>
</html>